<!-- https://www.bilibili.com/video/BV1HF411b77J?spm_id_from=333.999.0.0 -->
<!-- 该页面可以获取meatmask钱包的信息 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="#"/>
    <title>pute-js-ethereum-client-login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <!-- <title>Document</title> -->
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-light" >
        <div class="container-fluid">
            <span class="navbar-text">Twitter: @thinkingchain</span>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <h5>Account: <span class="showAccount" id="accountsSpan"></span></h5>
        <h5>Network: <span class="showAccount" id="networkSpan"></span></h5>
        <h5>ChainId: <span class="showAccount" id="chainIdSpan"></span></h5>

        <button class=" btn btn-primary" id="getAccountButton"> Get Account Button </button>
        <p> <span id="getAccountButtonResult"></span> </p>

        <button class=" btn btn-primary" id="sendButton"> send Button </button>
    </div>
</body>
<script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    //  --- here
    // 初始化方法,页面渲染完成后执行
     const initaillize = () => {
         const isMetaMaskIntalled = ()=> {
             const { ethereum } = window;
             if(typeof ethereum === 'undefined') {
                 return false;
             }
             return Boolean(ethereum && ethereum.isMetaMask)
         }

         const getAccount = async () => {
             try {
                 // 这个是获取账户的函数. ----- 不需要登陆.
                 const accounts = await ethereum.request({method: 'eth_requestAccounts'});
                 accountsSpan.innerHTML = accounts;
             } catch (error) {
                 console.error(error);
             }
         }

         const getNetworkAndChainId = async ()=>{
             try {
                 const ChainId = await ethereum.request({method: 'eth_chainId'});
                 chainIdSpan.innerHTML = ChainId;
                 const networkId = await ethereum.request({method: 'net_version'})
                 networkSpan.innerHTML = networkId;
             } catch (error) {
                console.error(error);
             }
         }

         const checkMetaMaskClient = async ()=>{
             // 判断是否安装
             if(!isMetaMaskIntalled()){
                 alert('please install metamask');
             }else{
                getNetworkAndChainId();
                getAccount();
                // alert('get the info ');
                // 获取后显示到上面21行 位置
             }
         }
         checkMetaMaskClient();
     }

     getAccountButton.onclick = async () => {
             try {
                 // 这个是获取账户的函数. ----- 必须要拥有登陆权限后才能登陆.
                 const accounts = await ethereum.request({method: 'eth_accounts'});
                 getAccountButtonResult.innerHTML = accounts;
             } catch (error) {
                 console.error(error);
             }
         }

    sendButton.onclick = async () => {
        try {
            const accounts = await ethereum.request({method: 'eth_requestAccounts'});
            web3.eth.sendTansaction(
                {
                    from: accounts[0],  // 要转出去的账户.
                    to: "0xd22877783e0e11f85f5a52df5777cd7f6b270aba", // 目的地的地址(随便找一个)
                    value:10000000000000000, //wei
                    gas:21000,
                    gasPrice:20000000000
                },(result) => {
                    console.log(result);
                }
            )
        } catch (error) {
            onsole.error(error);
        }
    }

    //  DOMContentLoaded 拼写错误导致报错.
     window.addEventListener('DOMContentLoaded',initaillize);
</script>
</html>